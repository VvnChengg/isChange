# Build stage
FROM node:18-alpine AS builder

WORKDIR /app/frontend

# 設置為環境變數
ENV PORT=${PORT}
ENV MONGODB_URL=${MONGODB_URL}
ENV NODEMAILER_USER=${NODEMAILER_USER}
ENV NODEMAILER_PASSWORD=${NODEMAILER_PASSWORD}
ENV JWT_SECRET_KEY=${JWT_SECRET_KEY}
ENV REACT_APP_API_HOSTNAME=${REACT_APP_API_HOSTNAME}
ENV REACT_APP_GOOGLE_MAPS_API_KEY=${REACT_APP_GOOGLE_MAPS_API_KEY}
ENV REACT_APP_SOCKET_SERVER_URL=${REACT_APP_SOCKET_SERVER_URL}

COPY frontend/ /app/frontend/

RUN npm install
RUN npm run build

# Run stage
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/frontend/build ./build
RUN npm install -g serve
EXPOSE 3001
CMD serve -s -n build -l 3001
